<!DOCTYPE html>
<html>
<head>
    <title>WABUCU Pre-Game</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
</head>
<body>
    <h1>ðŸŒ± Ð—Ð°Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ $WBC!</h1>
    <button id="connectBtn">ðŸ”— ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾ÑˆÐµÐ»ÐµÐº</button>
    <button id="clickBtn" disabled>ðŸŒ¾ Ð¡Ð¶Ð°Ñ‚ÑŒ! (0 ÐºÐ»Ð¸ÐºÐ¾Ð²)</button>
    <div id="address"></div>
    <script>
        // Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ game.js
        let userAddress = null;
        let clickCount = 0;

        // 1. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ°
        document.getElementById('connectBtn').addEventListener('click', async () => {
            console.log('ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð½Ð°Ð¶Ð°Ñ‚Ð°'); // Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
            
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    userAddress = accounts[0];
                    console.log('ÐÐ´Ñ€ÐµÑ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½:', userAddress);

                    // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…
                    const savedData = localStorage.getItem(userAddress);
                    clickCount = savedData ? parseInt(savedData) : 0;
                    
                    updateUI();
                    
                    // Ð¡Ð»ÑƒÑˆÐ°Ñ‚ÐµÐ»ÑŒ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°
                    window.ethereum.on('accountsChanged', (newAccounts) => {
                        userAddress = newAccounts[0] || null;
                        updateUI();
                    });

                } catch (error) {
                    alert("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ: " + error.message);
                }
            } else {
                alert("Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ MetaMask!");
            }
        });

        // 2. ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ»Ð¸ÐºÐ¾Ð²
        document.getElementById('clickBtn').addEventListener('click', () => {
            if (!userAddress) return;
            
            clickCount++;
            localStorage.setItem(userAddress, clickCount.toString());
            console.log('ÐšÐ»Ð¸ÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹:', clickCount);
            
            updateUI();
        });

        // 3. ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°
        function updateUI() {
            document.getElementById('connectBtn').disabled = !!userAddress;
            document.getElementById('clickBtn').disabled = !userAddress;
            document.getElementById('clickBtn').textContent = `ðŸŒ¾ Ð¡Ð¶Ð°Ñ‚ÑŒ! (${clickCount} ÐºÐ»Ð¸ÐºÐ¾Ð²)`;
            document.getElementById('address').textContent = userAddress 
                ? `ÐÐ´Ñ€ÐµÑ: ${userAddress.slice(0,6)}...${userAddress.slice(-4)}` 
                : '';
        }

        // ÐÐ²Ñ‚Ð¾Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ
        window.addEventListener('load', async () => {
            if (window.ethereum && window.ethereum.selectedAddress) {
                userAddress = window.ethereum.selectedAddress;
                const savedData = localStorage.getItem(userAddress);
                clickCount = savedData ? parseInt(savedData) : 0;
                updateUI();
            }
        });
    </script>
</body>
</html>
